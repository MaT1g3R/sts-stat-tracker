(()=>{(function(){function S(e){if(!e||typeof e!="string")return null;let a=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!a)return null;let t=parseInt(a[1],10),n=parseInt(a[2],10)-1,i=parseInt(a[3],10),r=new Date(Date.UTC(t,n,i));return r.getUTCFullYear()===t&&r.getUTCMonth()===n&&r.getUTCDate()===i?r:null}function m(e,a,t){if(!e||isNaN(e.getTime()))return"";let n={timeZone:"UTC"};switch(a){case"locale-short":n.dateStyle="short";break;case"locale-long":n.dateStyle="long";break;case"locale-full":n.dateStyle="full";break;case"locale-medium":default:n.dateStyle="medium";break}try{return new Intl.DateTimeFormat(t,n).format(e)}catch(i){console.error(`Error formatting date with Intl (locale: ${t}, format: ${a}, timezone: UTC):`,i);try{let r={dateStyle:"medium",timeZone:"UTC"};return new Intl.DateTimeFormat(t,r).format(e)}catch(r){console.error(`Error formatting date with fallback Intl (locale: ${t}, timezone: UTC):`,r);let s=e.getUTCFullYear(),d=(e.getUTCMonth()+1).toString().padStart(2,"0"),o=e.getUTCDate().toString().padStart(2,"0");return`${s}-${d}-${o}`}}}function p(e){if(!e||e.hasAttribute("data-initialized"))return;e.setAttribute("data-initialized","true");let a=e.id,t=e.querySelector("[data-datepicker-display]"),n=a+"-calendar-instance",i=document.getElementById(n),r=n+"-hidden",s=document.getElementById(r),d=i,o=s;if(!i||!s){let l=e.getAttribute("aria-controls"),c=l?document.getElementById(l):null;if(c&&(d||(d=c.querySelector("[data-calendar-container]")),!o)){let u=c.querySelector("[data-calendar-wrapper]");o=u?u.querySelector("[data-calendar-hidden-input]"):null}}if(!t||!d||!o){console.error("DatePicker init error: Missing required elements.",{datePickerID:a,displaySpan:t,calendar:d,hiddenInput:o});return}let y=e.dataset.displayFormat||"locale-medium",I=e.dataset.localeTag||"en-US",h=e.dataset.placeholder||"Select a date",C=l=>{if(!l.detail||!l.detail.date||!(l.detail.date instanceof Date))return;let c=l.detail.date,u=m(c,y,I);t.textContent=u,t.classList.remove("text-muted-foreground");let k=e.closest("[data-popover]")?.querySelector("[data-popover-trigger]");k instanceof HTMLElement?k.click():e.click()},D=()=>{if(o&&o.value){let l=S(o.value);if(l){let c=m(l,y,I);t.textContent.trim()!==c&&(t.textContent=c,t.classList.remove("text-muted-foreground"))}else t.textContent=h,t.classList.add("text-muted-foreground")}else t.textContent=h,t.classList.add("text-muted-foreground")};d.addEventListener("calendar-date-selected",C),D(),e._datePickerInitialized=!0,e._datePickerCleanup=()=>{d&&d.removeEventListener("calendar-date-selected",C)}}function f(e=document){e instanceof Element&&e.matches('[data-datepicker="true"]')&&p(e),e.querySelectorAll('[data-datepicker="true"]:not([data-initialized])').forEach(a=>{p(a)})}window.templUI=window.templUI||{},window.templUI.datePicker={init:f},document.addEventListener("DOMContentLoaded",()=>f())})();})();
