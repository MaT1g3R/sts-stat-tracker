(()=>{(function(){let b=!1;function C(u){if(!u||u.hasAttribute("data-initialized"))return;u.setAttribute("data-initialized","true");let r=u.querySelector("button.select-trigger");if(!r){console.error("Select box: Trigger button (.select-trigger) not found in wrapper",u);return}let m=r.dataset.contentId,w=r.dataset.multiple==="true",k=r.dataset.showPills==="true",x=m?document.getElementById(m):null,n=r.querySelector(".select-value"),a=r.querySelector('input[type="hidden"]');if(!x||!n||!a){console.error("Select box: Missing required elements for initialization.",{wrapper:u,contentID:m,contentExists:!!x,valueElExists:!!n,hiddenInputExists:!!a});return}r.addEventListener("keydown",e=>{(e.key.length===1||e.key==="Backspace"||e.key==="Delete")&&(e.preventDefault(),document.getElementById(m).click(),setTimeout(()=>{let t=document.querySelector("[data-select-search]");t&&(t.focus(),e.key!=="Backspace"&&e.key!=="Delete"&&(t.value=e.key))},0))});let s=x.cloneNode(!0);x.parentNode.replaceChild(s,x);let h=s.querySelector("[data-select-search]");if(h){let e=()=>{let t=window.getComputedStyle(s);t.display!=="none"&&t.visibility!=="hidden"&&t.opacity!=="0"&&h.focus()};document.addEventListener("click",t=>{r.contains(t.target)&&setTimeout(e,50)}),r.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&setTimeout(e,50)}),h.addEventListener("input",t=>{let o=t.target.value.toLowerCase().trim();s.querySelectorAll(".select-item").forEach(c=>{let d=c.querySelector(".select-item-text")?.textContent.toLowerCase()||"",i=c.getAttribute("data-value")?.toLowerCase()||"",p=o===""||d.includes(o)||i.includes(o);c.style.display=p?"":"none"})})}s.addEventListener("keydown",e=>{if(e.key==="ArrowDown"||e.key==="ArrowUp"){e.preventDefault();let t=Array.from(s.querySelectorAll(".select-item")).filter(c=>c.style.display!=="none");if(t.length===0)return;let o=s.querySelector(".select-item:focus"),l=0;if(o){let c=t.indexOf(o);e.key==="ArrowDown"?l=(c+1)%t.length:l=(c-1+t.length)%t.length}t[l].focus()}else if(e.key==="Enter"){e.preventDefault();let t=s.querySelector(".select-item:focus");t&&v(t)}else e.key==="Escape"&&(e.preventDefault(),s.querySelector(".select-item:focus")?h.focus():document.activeElement===h&&window.closePopover&&(window.closePopover(m,!0),setTimeout(()=>{r.focus()},50)))});let f=s.querySelectorAll('.select-item[data-selected="true"]');if(f.length>0)if(w){if(k){n.innerHTML="";let t=document.createElement("div");t.className="flex flex-nowrap overflow-hidden max-w-full whitespace-nowrap gap-1",Array.from(f).forEach(o=>{let l=document.createElement("div");l.className="flex items-center gap-1 px-2 py-1 text-xs rounded-md bg-primary text-primary-foreground";let c=document.createElement("span");c.textContent=o.querySelector(".select-item-text").textContent;let d=document.createElement("button");d.className="hover:text-destructive focus:outline-none",d.innerHTML="x",d.onclick=i=>{i.stopPropagation(),v(o)},l.appendChild(c),l.appendChild(d),t.appendChild(l)}),n.appendChild(t),n.classList.remove("text-muted-foreground"),setTimeout(()=>{let o=t.scrollWidth,l=n.clientWidth;if(o>l){let d=(r.dataset.selectedCountText||`${f.length} items selected`).replace("{n}",f.length);n.innerHTML=d,n.classList.remove("text-muted-foreground")}},0)}else n.textContent=`${f.length} items selected`,n.classList.remove("text-muted-foreground");let e=Array.from(f).map(t=>t.getAttribute("data-value"));a.value=e.join(",")}else{let e=f[0],t=e.querySelector(".select-item-text");if(t&&(n.textContent=t.textContent,n.classList.remove("text-muted-foreground")),a){let o=e.getAttribute("data-value")||"";a.hasAttribute("data-initialized")||(a.value=o,a.setAttribute("data-initialized","true"),a.dispatchEvent(new Event("change",{bubbles:!0})))}}function A(){s.querySelectorAll(".select-item").forEach(e=>{e.getAttribute("data-selected")==="true"?(e.classList.add("bg-accent","text-accent-foreground"),e.classList.remove("bg-muted")):e.classList.remove("bg-accent","text-accent-foreground","bg-muted")})}function v(e){if(!e||e.getAttribute("data-disabled")==="true"||b)return;b=!0;let t=e.getAttribute("data-value"),o=e.querySelector(".select-item-text");if(w){let l=e.getAttribute("data-selected")==="true";if(e.setAttribute("data-selected",(!l).toString()),l){e.classList.remove("bg-accent","text-accent-foreground");let i=e.querySelector(".select-check");i&&i.classList.replace("opacity-100","opacity-0")}else{e.classList.add("bg-accent","text-accent-foreground");let i=e.querySelector(".select-check");i&&i.classList.replace("opacity-0","opacity-100")}let c=s.querySelectorAll('.select-item[data-selected="true"]');if(c.length>0)if(k){n.innerHTML="";let i=document.createElement("div");i.className="flex flex-nowrap overflow-hidden max-w-full whitespace-nowrap gap-1",Array.from(c).forEach(p=>{let g=document.createElement("div");g.className="flex items-center gap-1 px-2 py-0.5 text-xs rounded-full bg-accent text-accent-foreground";let E=document.createElement("span");E.textContent=p.querySelector(".select-item-text").textContent;let y=document.createElement("button");y.className="hover:text-destructive focus:outline-none",y.innerHTML="\xD7",y.onclick=S=>{S.stopPropagation(),v(p)},g.appendChild(E),g.appendChild(y),i.appendChild(g)}),n.appendChild(i),n.classList.remove("text-muted-foreground"),setTimeout(()=>{let p=i.scrollWidth,g=n.clientWidth;if(p>g){let y=(r.dataset.selectedCountText||`${c.length} items selected`).replace("{n}",c.length);n.innerHTML=y,n.classList.remove("text-muted-foreground")}},0)}else n.textContent=`${c.length} items selected`,n.classList.remove("text-muted-foreground");else n.textContent=n.getAttribute("data-placeholder")||"",n.classList.add("text-muted-foreground");let d=Array.from(c).map(i=>i.getAttribute("data-value"));a.value=d.join(","),a.dispatchEvent(new Event("change",{bubbles:!0}))}else{s.querySelectorAll(".select-item").forEach(c=>{c.setAttribute("data-selected","false"),c.classList.remove("bg-accent","text-accent-foreground","bg-muted");let d=c.querySelector(".select-check");d&&d.classList.replace("opacity-100","opacity-0")}),e.setAttribute("data-selected","true"),e.classList.add("bg-accent","text-accent-foreground");let l=e.querySelector(".select-check");if(l&&l.classList.replace("opacity-0","opacity-100"),n&&o&&(n.textContent=o.textContent,n.classList.remove("text-muted-foreground")),a&&t!==null){let c=a.value;a.value=t,c!==t&&a.dispatchEvent(new Event("change",{bubbles:!0}))}window.closePopover?(window.closePopover(m,!0),setTimeout(()=>{r.focus()},50)):console.warn("closePopover function not found")}setTimeout(()=>{b=!1},100)}s.addEventListener("click",e=>{let t=e.target.closest(".select-item");t&&v(t)}),s.addEventListener("keydown",e=>{let t=e.target.closest(".select-item");t&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),v(t))}),s.addEventListener("mouseover",e=>{let t=e.target.closest(".select-item");!t||t.getAttribute("data-disabled")==="true"||(s.querySelectorAll(".select-item").forEach(o=>{o.classList.remove("bg-accent","text-accent-foreground","bg-muted")}),t.getAttribute("data-selected")!=="true"&&t.classList.add("bg-accent","text-accent-foreground"))}),s.addEventListener("mouseleave",A)}function L(u=document){u.querySelectorAll(".select-container").forEach(C)}window.templUI=window.templUI||{},window.templUI.selectbox={init:L},document.addEventListener("DOMContentLoaded",()=>L())})();})();
